<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet"  href="./css/jquery.mobile-1.1.0.css" />
	<link rel="stylesheet"  href="./css/mobilejquerysite.css" />
	<script src="./js/jquery-1.7.1.min.js"></script>
	<script src="./js/jquery.mobile-1.1.1.min.js"></script>
	<script src="./js/cordova-2.1.0.js"></script>
	<script src="./js/crawlcreatefinal.js"></script>
</head>
<body>
	<div data-role="header">
		<a href="#" onClick="backButtonClicked()">Back</a>
		<h1>CREATE A CRAWL</h1>
		<a href="./index.html" data-icon="home" data-ajax="false" class="ui-btn-right">Home</a>
	</div>
	<div data-role="content">
		<div class="header_logo">
			<img src="./images/mobile/mobile_header.png" />
		</div>
		<div class="mobile_hr"></div>
		<p id="crawl_destination">Destination: </p>
		<p id="crawl_first_stop">First Stop: </p>
		<form action="" method="POST" data-ajax="false" id="crawl_form" data-ajax="false">
		<label for="name">Title: </label>
		<input type="text" name="title" id="id_title" value="" />
		<label for="select-choice-0" class="select">Crawl Type:</label>
		<select name="type" id="id_type">
			<option value="b">Birthday</option>
			<option value="t">Team Building Exercise</option>
			<option value="o">Other</option>
		</select>
		<fieldset data-role="controlgroup" data-type="horizontal">
		<legend>Date:</legend>
		
		<label for="select-choice-month">Month</label>
		<select name="select-choice-month" id="select-choice-month">
			<option value="01">January</option>
			<option value="02">February</option>
			<option value="03">March</option>
			<option value="04">April</option>
			<option value="05">May</option>
			<option value="06">June</option>
			<option value="07">July</option>
			<option value="08">August</option>
			<option value="09">September</option>
			<option value="10">October</option>
			<option value="11">November</option>
			<option value="12">December</option>
		</select>

		<label for="select-choice-day">Day</label>
		<select name="select-choice-day" id="select-choice-day">
			<option value="1">1</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5</option>
			<option value="6">6</option>
			<option value="7">7</option>
			<option value="8">8</option>
			<option value="9">9</option>
			<option value="10">10</option>
			<option value="11">11</option>
			<option value="12">13</option>
			<option value="13">13</option>
			<option value="14">14</option>
			<option value="15">15</option>
			<option value="16">16</option>
			<option value="17">17</option>
			<option value="18">18</option>
			<option value="19">19</option>
			<option value="20">20</option>
			<option value="21">21</option>
			<option value="22">22</option>
			<option value="23">23</option>
			<option value="24">24</option>
			<option value="25">25</option>
			<option value="26">26</option>
			<option value="27">27</option>
			<option value="28">28</option>
			<option value="29">29</option>
			<option value="30">30</option>
			<option value="31">31</option>
		</select>

		<label for="select-choice-year">Year</label>
		<select name="select-choice-year" id="select-choice-year">
			<option value="2012">2012</option>
			<option value="2013">2013</option>
		</select>
		</fieldset>
		<fieldset data-role="controlgroup" data-type="horizontal">
		<legend>Start Time:</legend>
		
		<label for="select-choice-month">Hour</label>
		<select name="select-choice-hour" id="select-choice-hour">
			<option value="01">1</option>
			<option value="02">2</option>
			<option value="03">3</option>
			<option value="04">4</option>
			<option value="05">5</option>
			<option value="06">6</option>
			<option value="07">7</option>
			<option value="08">8</option>
			<option value="09">9</option>
			<option value="10">10</option>
			<option value="11">11</option>
			<option value="12">12</option>
		</select>

		<label for="select-choice-day">Minutes</label>
		<select name="select-choice-minute" id="select-choice-minute">
			<option value="00">00</option>
			<option value="15">15</option>
			<option value="30">30</option>
			<option value="45">45</option>
		</select>

		<label for="select-choice-ampm">AM/PM</label>
		<select name="select-choice-ampm" id="select-choice-ampm">
			<option value="pm">PM</option>
			<option value="am">AM</option>
		</select>
	</fieldset>
	<label for="flip-1">Make Crawl Public or Invite Only:</label>
	<select name="isPublic" id="id_isPublic" data-role="slider">
		<option value="i">Invite Only</option>
		<option value="p">Public</option>
	</select>
	<input value="Create Crawl" type="submit">
	<p style="display:none;"><input id="id_date" type="text" name="date" /></p>
	<p style="display:none;"><input id="id_barpk" type="text" name="barpk" /></p>
	</form>
	</div>
	<script>
	function backButtonClicked() {
		navigator.app.backHistory();
	}
	</script>
<script>
$('#crawl_form').submit(function(event) {
		// stop form from submitting
        event.preventDefault();
        // stop jquery mobile from submitting the form
        event.stopImmediatePropagation();

        var selecteddate = $("#select-choice-month").find(":selected").val();
        selecteddate += "/" + $("#select-choice-day").find(":selected").val();
        selecteddate += "/" + $("#select-choice-year").find(":selected").val() + " ";
        var timeVar = $("#select-choice-hour").find(":selected").val();
        timeVar += ":" + $("#select-choice-minute").find(":selected").val();
        var convertedTime = '';

        if ($("#select-choice-ampm").find(":selected").val() == "pm") {
                var hours = timeVar.substring(0, 2);
                hoursInt = parseInt(hours, 10);
                hoursInt += 12;
                convertedTime = hoursInt + timeVar.substring(2, timeVar.length);
        } else {
                convertedTime = timeVar.substring(0, timeVar.length);
        }

        $("#id_date").val(selecteddate + convertedTime);
        //send a post request to your web-service
        $.post("http://nationwidebarcrawl.com/mobilenative/crawls/createcrawl/", $(this).serialize(), function(response) {
            //parse the response string into an object
            var crawl_info = $.parseJSON(response);
            localStorage.setItem("chosencrawl", crawl_info['crawlpk']);
            // TODO: call index.html and call crawlClicked() to show the new crawl
            window.location.href="index.html";
		});
});

</script>
</body>
</html>